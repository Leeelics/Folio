# Equilibra äº§å“æ”¹è¿›è®¾è®¡æ–‡æ¡£

## Context

ç”¨æˆ·åœ¨å®é™…æµ‹è¯•ä¸­å‘ç°4ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š
1. è´¦æˆ·ç®¡ç†æ²¡æœ‰æ·»åŠ è´¦æˆ·çš„èƒ½åŠ›ï¼ˆä¾§è¾¹æ åˆ›å»ºè¡¨å•æœªè¢«å‘ç°ï¼‰ï¼Œç°é‡‘å’ŒæŠ•èµ„è´¦æˆ·éƒ½æ²¡æœ‰
2. é¢„ç®—ç®¡ç†ç¼ºå°‘ç¼–è¾‘ã€åˆ é™¤ã€å½’æ¡£ç­‰ç”Ÿå‘½å‘¨æœŸç®¡ç†èƒ½åŠ›ï¼Œä¹Ÿæ²¡æœ‰å½•å…¥æ”¯å‡ºçš„å¿«æ·å…¥å£
3. æ”¯å‡ºå½•å…¥é¡µé¢å®šä½æ¨¡ç³Šâ€”â€”æ˜¯è´¦æˆ·ç°é‡‘ç®¡ç†è¿˜æ˜¯æ—¥å¸¸æ¶ˆè´¹è®°è´¦ï¼ŸåŠŸèƒ½è¾¹ç•Œä¸æ¸…
4. èµ„äº§æ€»è§ˆæ•°æ®åˆ†æå’Œå¯è§†åŒ–èƒ½åŠ›å¤ªå¼±ï¼Œä¸”èµ„äº§åˆ†å¸ƒåŒºåŸŸæ··å…¥äº†é¢„ç®—å†…å®¹

åŒæ—¶è¯†åˆ«å‡ºä¸€ä¸ªç¼ºå¤±æ¨¡å—ï¼š**è´Ÿå€ºç®¡ç†**ï¼ˆæˆ¿è´·ã€è½¦è´·ã€ä¿¡ç”¨å¡ã€å…¶ä»–è´·æ¬¾ï¼‰ï¼Œè¿™æ˜¯è®¡ç®—å‡€èµ„äº§çš„å¿…è¦ç»„æˆéƒ¨åˆ†ã€‚

---

## ä¸€ã€ä¿¡æ¯æ¶æ„ï¼ˆä¿®è®¢åï¼‰

```
Homeï¼ˆé¦–é¡µï¼‰
â”œâ”€â”€ 1_ğŸ“Š èµ„äº§æ€»è§ˆ    â€” æ•°æ®çœ‹æ¿ & å›¾è¡¨åˆ†æï¼ˆåªè¯»ï¼‰
â”œâ”€â”€ 2_ğŸ’° è´¦æˆ·ç®¡ç†    â€” èµ„äº§è´¦æˆ· + è´Ÿå€ºè´¦æˆ· CRUDï¼Œè½¬è´¦ï¼Œå¤§é¢æ”¶æ”¯
â”œâ”€â”€ 3_ğŸ“… é¢„ç®—ç®¡ç†    â€” é¢„ç®—å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
â””â”€â”€ 4_ğŸ“ æ—¥å¸¸è®°è´¦    â€” æ—¥å¸¸æ¶ˆè´¹è®°å½•ï¼ˆåŸ"æ”¯å‡ºå½•å…¥"é‡æ–°å®šä½ï¼‰
```

**å˜æ›´è¯´æ˜ï¼š**
- `4_ğŸ’¸_æ”¯å‡ºå½•å…¥.py` â†’ é‡å‘½åä¸º `4_ğŸ“_æ—¥å¸¸è®°è´¦.py`ï¼Œæ˜ç¡®å®šä½ä¸ºæ—¥å¸¸æ¶ˆè´¹è®°å½•
- è´¦æˆ·ç®¡ç†æ–°å¢è´Ÿå€ºè´¦æˆ·ç®¡ç†
- å¤§é¢æ”¶æ”¯ï¼ˆå·¥èµ„ã€è½¬è´¦ç­‰ï¼‰å½’å…¥è´¦æˆ·ç®¡ç†

---

## äºŒã€å„é¡µé¢è¯¦ç»†è®¾è®¡

### 2.1 èµ„äº§æ€»è§ˆï¼ˆ1_ğŸ“Š_èµ„äº§æ€»è§ˆ.pyï¼‰

**å®šä½ï¼š** åªè¯»æ•°æ®çœ‹æ¿ï¼Œæä¾›å…¨å±€è´¢åŠ¡è§†å›¾å’Œå›¾è¡¨åˆ†æ

**å¸ƒå±€ç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ï¼ˆ4åˆ—ï¼‰                               â”‚
â”‚  [å‡€èµ„äº§] [æ€»èµ„äº§] [æ€»è´Ÿå€º] [æœ¬æœˆæ”¯å‡º]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èµ„äº§åˆ†å¸ƒé¥¼å›¾            â”‚  è´¦æˆ·ä½™é¢æŸ±çŠ¶å›¾          â”‚
â”‚  (æŒ‰è´¦æˆ·ç±»å‹:ç°é‡‘/æŠ•èµ„)   â”‚  (å„è´¦æˆ·ä½™é¢å¯¹æ¯”)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è´Ÿå€ºæ¦‚è§ˆ                                         â”‚
â”‚  å„è´Ÿå€ºè´¦æˆ·ä½™é¢ã€æœˆä¾›ï¼Œæ€»è´Ÿå€ºé‡‘é¢                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœˆåº¦æ”¯å‡ºè¶‹åŠ¿æŠ˜çº¿å›¾       â”‚  æ”¯å‡ºåˆ†ç±»é¥¼å›¾            â”‚
â”‚  (è¿‘6ä¸ªæœˆ)              â”‚  (æœ¬æœˆå„ç±»åˆ«å æ¯”)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¢„ç®—æ‰§è¡Œæ¦‚è§ˆ                                      â”‚
â”‚  æ´»è·ƒé¢„ç®—è¿›åº¦æ¡åˆ—è¡¨ï¼ˆç‹¬ç«‹åŒºåŸŸï¼Œä¸æ··å…¥èµ„äº§åˆ†å¸ƒï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®æ”¹åŠ¨ï¼š**
- æ ¸å¿ƒæŒ‡æ ‡å¢åŠ ã€Œå‡€èµ„äº§ã€ï¼ˆæ€»èµ„äº§ - æ€»è´Ÿå€ºï¼‰å’Œã€Œæ€»è´Ÿå€ºã€
- èµ„äº§åˆ†å¸ƒåŒºåŸŸç§»é™¤é¢„ç®—ç›¸å…³å†…å®¹
- æ–°å¢4ä¸ª Plotly å›¾è¡¨ï¼šèµ„äº§åˆ†å¸ƒé¥¼å›¾ã€è´¦æˆ·ä½™é¢æŸ±çŠ¶å›¾ã€æœˆåº¦æ”¯å‡ºè¶‹åŠ¿ã€æ”¯å‡ºåˆ†ç±»é¥¼å›¾
- æ–°å¢è´Ÿå€ºæ¦‚è§ˆåŒºåŸŸ
- é¢„ç®—æ‰§è¡Œç§»åˆ°é¡µé¢åº•éƒ¨ç‹¬ç«‹åŒºåŸŸ

**éœ€è¦çš„æ–° APIï¼š**
- `GET /core/dashboard/enhanced` â€” è¿”å›å¢å¼ºæ•°æ®ï¼ˆå«è´Ÿå€ºæ±‡æ€»ã€æœˆåº¦æ”¯å‡ºè¶‹åŠ¿ã€åˆ†ç±»æ±‡æ€»ï¼‰
- æˆ–è€…å‰ç«¯ä»ç°æœ‰ API ç»„åˆæ•°æ®ï¼ˆ`get_accounts` + `get_expenses` + `get_budgets`ï¼‰

---

### 2.2 è´¦æˆ·ç®¡ç†ï¼ˆ2_ğŸ’°_è´¦æˆ·ç®¡ç†.pyï¼‰

**å®šä½ï¼š** ç®¡ç†æ‰€æœ‰è´¦æˆ·ï¼ˆèµ„äº§ + è´Ÿå€ºï¼‰ï¼Œå¤„ç†è´¦æˆ·é—´è½¬è´¦å’Œå¤§é¢æ”¶æ”¯

**å¸ƒå±€ç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¾§è¾¹æ ï¼ˆä¿æŒç°æœ‰ï¼‰ â”‚  â”‚  ä¸»åŒºåŸŸ                        â”‚
â”‚                  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ·»åŠ ç°é‡‘è´¦æˆ·      â”‚  â”‚  è´¦æˆ·ç»Ÿè®¡å¡ç‰‡ï¼ˆ4åˆ—ï¼‰             â”‚
â”‚  æ·»åŠ æŠ•èµ„è´¦æˆ·      â”‚  â”‚  [æ€»èµ„äº§] [ç°é‡‘] [æŠ•èµ„] [è´Ÿå€º]   â”‚
â”‚  æ·»åŠ è´Ÿå€ºè´¦æˆ·      â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚  â”‚  Tab: ç°é‡‘è´¦æˆ·|æŠ•èµ„è´¦æˆ·|è´Ÿå€ºè´¦æˆ·  â”‚
â”‚  è´¦æˆ·é—´è½¬è´¦       â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ·»åŠ æŒä»“         â”‚  â”‚  è´¦æˆ·åˆ—è¡¨ï¼ˆæŒ‰ Tab åˆ‡æ¢ï¼‰         â”‚
â”‚                  â”‚  â”‚  æ¯ä¸ªè´¦æˆ·å¡ç‰‡ + æ“ä½œæŒ‰é’®          â”‚
â”‚                  â”‚  â”‚  æŠ•èµ„è´¦æˆ·å±•å¼€æ˜¾ç¤ºæŒä»“æ˜ç»†          â”‚
â”‚                  â”‚  â”‚  è´Ÿå€ºè´¦æˆ·æ˜¾ç¤ºå‰©ä½™æœ¬é‡‘/æœˆä¾›         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®æ”¹åŠ¨ï¼š**
- åˆ›å»ºè´¦æˆ·ã€è½¬è´¦ã€æ·»åŠ æŒä»“ç­‰æ“ä½œä¿ç•™åœ¨ä¾§è¾¹æ ï¼ˆç°æœ‰æ¨¡å¼ï¼‰
- ä¾§è¾¹æ æ–°å¢ã€Œæ·»åŠ è´Ÿå€ºè´¦æˆ·ã€è¡¨å•
- æ–°å¢ã€Œè´Ÿå€ºè´¦æˆ·ã€Tab å’Œå®Œæ•´ CRUD
- æ–°å¢ã€Œè®°å½•è¿˜æ¬¾ã€æ“ä½œï¼ˆè¿˜æ¬¾ = ä»ç°é‡‘/æŠ•èµ„è´¦æˆ·æ‰£æ¬¾ + å‡å°‘è´Ÿå€ºä½™é¢ï¼‰

**è´Ÿå€ºè´¦æˆ·æ•°æ®æ¨¡å‹ï¼ˆåŸºç¡€ç‰ˆï¼‰ï¼š**
```
Liabilityï¼ˆè´Ÿå€ºè´¦æˆ·ï¼‰
- id, name
- liability_type: mortgage / car_loan / credit_card / other
- institution: è´·æ¬¾æœºæ„/é“¶è¡Œ
- original_amount: åˆå§‹è´·æ¬¾é‡‘é¢
- remaining_amount: å‰©ä½™æœ¬é‡‘
- monthly_payment: æœˆä¾›é‡‘é¢
- interest_rate: å¹´åˆ©ç‡ï¼ˆå¯é€‰ï¼Œè®°å½•ç”¨ï¼‰
- start_date: è´·æ¬¾å¼€å§‹æ—¥æœŸ
- end_date: è´·æ¬¾ç»“æŸæ—¥æœŸï¼ˆå¯é€‰ï¼‰
- payment_day: æ¯æœˆè¿˜æ¬¾æ—¥
- currency, is_active, notes
- created_at, updated_at
```

**éœ€è¦çš„æ–° APIï¼š**
- `POST /core/liabilities` â€” åˆ›å»ºè´Ÿå€ºè´¦æˆ·
- `GET /core/liabilities` â€” åˆ—è¡¨ï¼ˆç­›é€‰: type, is_activeï¼‰
- `GET /core/liabilities/{id}` â€” è¯¦æƒ…
- `PUT /core/liabilities/{id}` â€” ç¼–è¾‘
- `DELETE /core/liabilities/{id}` â€” åˆ é™¤
- `POST /core/liabilities/{id}/payment` â€” è®°å½•è¿˜æ¬¾ï¼ˆå…³è”æ‰£æ¬¾è´¦æˆ·ï¼Œå‡å°‘ remaining_amountï¼Œç”Ÿæˆ cash_flowï¼‰

---

### 2.3 é¢„ç®—ç®¡ç†ï¼ˆ3_ğŸ“…_é¢„ç®—ç®¡ç†.pyï¼‰

**å®šä½ï¼š** é¢„ç®—çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†

**å¸ƒå±€ç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¾§è¾¹æ ï¼ˆä¿æŒç°æœ‰ï¼‰ â”‚  â”‚  ä¸»åŒºåŸŸ                        â”‚
â”‚                  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åˆ›å»ºé¢„ç®—è¡¨å•      â”‚  â”‚  é¢„ç®—ç»Ÿè®¡å¡ç‰‡ï¼ˆ3åˆ—ï¼‰             â”‚
â”‚  - åç§°           â”‚  â”‚  [æ´»è·ƒæ•°] [æ€»é¢] [å·²æ”¯å‡º]       â”‚
â”‚  - ç±»å‹           â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - é‡‘é¢           â”‚  â”‚  Tab: æ´»è·ƒé¢„ç®—|å·²å®Œæˆ|å·²å–æ¶ˆ     â”‚
â”‚  - èµ·æ­¢æ—¥æœŸ       â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - å…³è”è´¦æˆ·       â”‚  â”‚  é¢„ç®—å¡ç‰‡åˆ—è¡¨                    â”‚
â”‚  - å¤‡æ³¨           â”‚  â”‚  è¿›åº¦æ¡ + æ“ä½œæŒ‰é’®               â”‚
â”‚                  â”‚  â”‚  [ç¼–è¾‘][è®°ä¸€ç¬”][ç»“ç®—][å–æ¶ˆ][åˆ é™¤] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®æ”¹åŠ¨ï¼š**
- åˆ›å»ºé¢„ç®—ä¿ç•™åœ¨ä¾§è¾¹æ ï¼ˆç°æœ‰æ¨¡å¼ï¼‰
- æ–°å¢ã€Œç¼–è¾‘é¢„ç®—ã€â€” ä¿®æ”¹åç§°ã€é‡‘é¢ã€æ—¥æœŸã€å…³è”è´¦æˆ·ã€å¤‡æ³¨
- æ–°å¢ã€Œå–æ¶ˆé¢„ç®—ã€â€” å°†çŠ¶æ€è®¾ä¸º cancelled
- æ–°å¢ã€Œåˆ é™¤é¢„ç®—ã€â€” ä»…å…è®¸åˆ é™¤æ— å…³è”æ”¯å‡ºçš„é¢„ç®—ï¼Œæˆ–å·²å®Œæˆ/å·²å–æ¶ˆçš„é¢„ç®—
- ã€Œè®°ä¸€ç¬”ã€æŒ‰é’®è·³è½¬åˆ°æ—¥å¸¸è®°è´¦é¡µé¢ï¼Œå¹¶é€šè¿‡ URL å‚æ•°é¢„å¡« budget_id
- å·²å®Œæˆå’Œå·²å–æ¶ˆçš„é¢„ç®—ç”¨æŠ˜å åŒºåŸŸå±•ç¤ºï¼Œä¿æŒé¡µé¢æ•´æ´

**éœ€è¦çš„æ–° APIï¼š**
- `PUT /core/budgets/{id}` â€” ç¼–è¾‘é¢„ç®—ï¼ˆname, amount, period_start, period_end, associated_account_ids, notesï¼‰
- `DELETE /core/budgets/{id}` â€” åˆ é™¤é¢„ç®—ï¼ˆæ ¡éªŒï¼šæ— å…³è”æ”¯å‡ºæˆ–çŠ¶æ€ä¸º completed/cancelledï¼‰
- `POST /core/budgets/{id}/cancel` â€” å–æ¶ˆé¢„ç®—

---

### 2.4 æ—¥å¸¸è®°è´¦ï¼ˆ4_ğŸ“_æ—¥å¸¸è®°è´¦.pyï¼ŒåŸæ”¯å‡ºå½•å…¥ï¼‰

**å®šä½ï¼š** æ—¥å¸¸æ¶ˆè´¹çš„å¿«é€Ÿè®°å½•ï¼Œå…³è”è´¦æˆ·å’Œé¢„ç®—

**å¸ƒå±€ç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¿«é€Ÿè®°è´¦è¡¨å•                                      â”‚
â”‚  é‡‘é¢ï¼ˆå¤§å­—è¾“å…¥ï¼‰                                   â”‚
â”‚  è´¦æˆ·é€‰æ‹©ï¼ˆä»å“ªä¸ªè´¦æˆ·æ”¯å‡ºï¼‰                           â”‚
â”‚  åˆ†ç±»é€‰æ‹©ï¼ˆå¤§ç±» â†’ å°ç±»ï¼‰                            â”‚
â”‚  æ—¥æœŸï¼ˆé»˜è®¤ä»Šå¤©ï¼‰                                   â”‚
â”‚  å•†æˆ·/ä½ç½®ï¼ˆå¯é€‰ï¼‰                                  â”‚
â”‚  æ”¯ä»˜æ–¹å¼ï¼ˆç°é‡‘/æ”¯ä»˜å®/å¾®ä¿¡/é“¶è¡Œå¡/ä¿¡ç”¨å¡ï¼‰            â”‚
â”‚  å…³è”é¢„ç®—ï¼ˆå¯é€‰ï¼Œä¸‹æ‹‰é€‰æ‹©æ´»è·ƒé¢„ç®—ï¼‰                    â”‚
â”‚  æ˜¯å¦AAï¼ˆå¯é€‰ï¼‰                                    â”‚
â”‚  å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰                                      â”‚
â”‚  [æäº¤]                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿‘æœŸè®°è´¦è®°å½•                                      â”‚
â”‚  è¡¨æ ¼: æ—¥æœŸã€é‡‘é¢ã€åˆ†ç±»ã€è´¦æˆ·ã€é¢„ç®—ã€å•†æˆ·              â”‚
â”‚  æ”¯æŒæŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰                                  â”‚
â”‚  æ“ä½œ: [åˆ é™¤]                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®æ”¹åŠ¨ï¼š**
- é¡µé¢é‡å‘½åï¼šæ”¯å‡ºå½•å…¥ â†’ æ—¥å¸¸è®°è´¦
- æ˜ç¡®å®šä½ï¼šåªå¤„ç†æ—¥å¸¸æ¶ˆè´¹ï¼Œä¸å¤„ç†è½¬è´¦/å·¥èµ„ç­‰ï¼ˆé‚£äº›åœ¨è´¦æˆ·ç®¡ç†ï¼‰
- è¡¨å•ç®€åŒ–ï¼šé‡‘é¢æ”¾å¤§çªå‡ºï¼Œå¿…å¡«é¡¹æœ€å°‘åŒ–ï¼ˆé‡‘é¢ã€è´¦æˆ·ã€åˆ†ç±»ï¼‰
- æ”¯æŒä»é¢„ç®—ç®¡ç†é¡µé¢è·³è½¬è¿‡æ¥æ—¶è‡ªåŠ¨é¢„å¡« budget_id
- è¿‘æœŸè®°å½•å¢åŠ åˆ é™¤åŠŸèƒ½

**éœ€è¦çš„æ–° APIï¼š**
- `DELETE /core/expenses/{id}` â€” åˆ é™¤æ”¯å‡ºï¼ˆå›æ»šè´¦æˆ·ä½™é¢å’Œé¢„ç®—å·²èŠ±é‡‘é¢ï¼‰

---

## ä¸‰ã€æ•°æ®æ¨¡å‹å˜æ›´

### æ–°å¢ï¼šLiability æ¨¡å‹

```python
class Liability(Base):
    __tablename__ = "liabilities"

    id = Column(Integer, primary_key=True)
    name = Column(String(100), nullable=False)
    liability_type = Column(String(20), nullable=False)  # mortgage/car_loan/credit_card/other
    institution = Column(String(100))
    original_amount = Column(Numeric(15, 2), nullable=False)
    remaining_amount = Column(Numeric(15, 2), nullable=False)
    monthly_payment = Column(Numeric(15, 2))
    interest_rate = Column(Numeric(5, 4))  # å¹´åˆ©ç‡ï¼Œå¦‚ 0.0388
    start_date = Column(Date)
    end_date = Column(Date)
    payment_day = Column(Integer)  # æ¯æœˆè¿˜æ¬¾æ—¥ 1-31
    currency = Column(String(10), default="CNY")
    is_active = Column(Boolean, default=True)
    notes = Column(Text)
    created_at = Column(DateTime, server_default=func.now())
    updated_at = Column(DateTime, onupdate=func.now())
```

### æ–°å¢ï¼šLiabilityPayment æ¨¡å‹

```python
class LiabilityPayment(Base):
    __tablename__ = "liability_payments"

    id = Column(Integer, primary_key=True)
    liability_id = Column(Integer, ForeignKey("liabilities.id"))
    account_id = Column(Integer, ForeignKey("accounts.id"))  # ä»å“ªä¸ªè´¦æˆ·è¿˜æ¬¾
    amount = Column(Numeric(15, 2), nullable=False)
    principal = Column(Numeric(15, 2))  # æœ¬é‡‘éƒ¨åˆ†ï¼ˆå¯é€‰ï¼‰
    interest = Column(Numeric(15, 2))   # åˆ©æ¯éƒ¨åˆ†ï¼ˆå¯é€‰ï¼‰
    payment_date = Column(Date, nullable=False)
    notes = Column(Text)
    created_at = Column(DateTime, server_default=func.now())
```

---

## å››ã€API å˜æ›´æ±‡æ€»

### æ–°å¢ APIï¼ˆå…± 9 ä¸ªï¼‰

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/core/liabilities` | POST | åˆ›å»ºè´Ÿå€ºè´¦æˆ· |
| `/core/liabilities` | GET | è´Ÿå€ºåˆ—è¡¨ |
| `/core/liabilities/{id}` | GET | è´Ÿå€ºè¯¦æƒ… |
| `/core/liabilities/{id}` | PUT | ç¼–è¾‘è´Ÿå€º |
| `/core/liabilities/{id}` | DELETE | åˆ é™¤è´Ÿå€º |
| `/core/liabilities/{id}/payment` | POST | è®°å½•è¿˜æ¬¾ |
| `/core/budgets/{id}` | PUT | ç¼–è¾‘é¢„ç®— |
| `/core/budgets/{id}` | DELETE | åˆ é™¤é¢„ç®— |
| `/core/budgets/{id}/cancel` | POST | å–æ¶ˆé¢„ç®— |

### ä¿®æ”¹ APIï¼ˆå…± 2 ä¸ªï¼‰

| ç«¯ç‚¹ | å˜æ›´ |
|------|------|
| `GET /core/dashboard` | å¢åŠ è¿”å›å­—æ®µï¼štotal_liability, net_worth, monthly_expense_trend, expense_by_category |
| `DELETE /core/expenses/{id}` | æ–°å¢ï¼šåˆ é™¤æ”¯å‡ºå¹¶å›æ»šä½™é¢ |

---

## äº”ã€å®æ–½é¡ºåº

### Phase Aï¼šåç«¯ API
1. æ–°å¢ Liability + LiabilityPayment æ¨¡å‹ï¼Œè¿è¡Œ init_db å»ºè¡¨
2. æ–°å¢è´Ÿå€ºç›¸å…³ 6 ä¸ª API ç«¯ç‚¹
3. æ–°å¢é¢„ç®—ç¼–è¾‘/åˆ é™¤/å–æ¶ˆ 3 ä¸ª API ç«¯ç‚¹
4. æ–°å¢æ”¯å‡ºåˆ é™¤ API
5. å¢å¼º dashboard API è¿”å›æ•°æ®

### Phase Bï¼šå‰ç«¯é¡µé¢é‡æ„
1. è´¦æˆ·ç®¡ç† â€” ä¾§è¾¹æ æ–°å¢è´Ÿå€ºè´¦æˆ·è¡¨å•ï¼Œä¸»åŒºåŸŸæ–°å¢è´Ÿå€º Tabï¼Œæ–°å¢è¿˜æ¬¾æ“ä½œ
2. é¢„ç®—ç®¡ç† â€” æ–°å¢ç¼–è¾‘/å–æ¶ˆ/åˆ é™¤æ“ä½œï¼ŒTab åˆ†ç»„
3. æ—¥å¸¸è®°è´¦ â€” é‡å‘½åé¡µé¢ï¼Œç®€åŒ–è¡¨å•ï¼Œå¢åŠ åˆ é™¤åŠŸèƒ½
4. èµ„äº§æ€»è§ˆ â€” æ–°å¢ Plotly å›¾è¡¨ï¼Œåˆ†ç¦»èµ„äº§/é¢„ç®—åŒºåŸŸï¼Œæ–°å¢è´Ÿå€ºæ¦‚è§ˆ

### Phase Cï¼šAPI Client æ›´æ–°
- `streamlit_app/api_client.py` æ–°å¢æ–¹æ³•ï¼š
  - `create_liability()`, `get_liabilities()`, `get_liability()`, `update_liability()`, `delete_liability()`, `create_liability_payment()`
  - `update_budget()`, `delete_budget()`, `cancel_budget()`
  - `delete_expense()`

---

## å…­ã€å…³é”®æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | æ“ä½œ |
|------|------|
| `app/models/core.py` | æ–°å¢ Liability, LiabilityPayment æ¨¡å‹ |
| `app/api/core_routes.py` | æ–°å¢ 9 ä¸ªç«¯ç‚¹ï¼Œä¿®æ”¹ 2 ä¸ªç«¯ç‚¹ |
| `app/database.py` | init_db ä¸­ import æ–°æ¨¡å‹ |
| `streamlit_app/api_client.py` | æ–°å¢ 10 ä¸ªå®¢æˆ·ç«¯æ–¹æ³• |
| `streamlit_app/pages/1_ğŸ“Š_èµ„äº§æ€»è§ˆ.py` | é‡æ„ä¸ºå›¾è¡¨çœ‹æ¿ |
| `streamlit_app/pages/2_ğŸ’°_è´¦æˆ·ç®¡ç†.py` | é‡æ„å¸ƒå±€ï¼Œæ–°å¢è´Ÿå€ºç®¡ç† |
| `streamlit_app/pages/3_ğŸ“…_é¢„ç®—ç®¡ç†.py` | æ–°å¢ç”Ÿå‘½å‘¨æœŸæ“ä½œ |
| `streamlit_app/pages/4_ğŸ’¸_æ”¯å‡ºå½•å…¥.py` | é‡å‘½åä¸º `4_ğŸ“_æ—¥å¸¸è®°è´¦.py`ï¼Œé‡æ–°å®šä½ |

---

## ä¸ƒã€éªŒè¯æ–¹å¼

1. **API æµ‹è¯•ï¼š** å¯¹æ¯ä¸ªæ–°å¢/ä¿®æ”¹çš„ç«¯ç‚¹ç”¨ curl æˆ– pytest éªŒè¯ CRUD æ­£ç¡®æ€§
2. **å‰ç«¯æ‰‹åŠ¨æµ‹è¯•ï¼š**
   - åˆ›å»ºç°é‡‘/æŠ•èµ„/è´Ÿå€ºè´¦æˆ· â†’ éªŒè¯åˆ—è¡¨æ˜¾ç¤º
   - åˆ›å»ºé¢„ç®— â†’ ç¼–è¾‘ â†’ è®°è´¦ â†’ ç»“ç®—/å–æ¶ˆ â†’ åˆ é™¤
   - æ—¥å¸¸è®°è´¦ â†’ éªŒè¯è´¦æˆ·ä½™é¢æ‰£å‡ã€é¢„ç®—å·²èŠ±æ›´æ–°
   - è®°å½•è¿˜æ¬¾ â†’ éªŒè¯è´Ÿå€ºä½™é¢å‡å°‘ã€ç°é‡‘è´¦æˆ·æ‰£æ¬¾
   - èµ„äº§æ€»è§ˆ â†’ éªŒè¯å›¾è¡¨æ•°æ®æ­£ç¡®ã€å‡€èµ„äº§ = æ€»èµ„äº§ - æ€»è´Ÿå€º
3. **æ•°æ®ä¸€è‡´æ€§ï¼š** åˆ é™¤æ”¯å‡ºåéªŒè¯ä½™é¢å›æ»šï¼Œåˆ é™¤é¢„ç®—éªŒè¯å…³è”æ ¡éªŒ
